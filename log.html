<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <form class="log">
      <input class="email" name="email" placeholder="email" type="email" />
      <input
        class="password"
        name="password"
        placeholder="password"
        type="text"
      />
      <button class="login">Log</button>
    </form>
    <div class="editor">
      <button class="logout">Logout</button>
      <form class="log editor__form">
        <input class="title" placeholder="title" type="text" />
        <input class="subtitle" placeholder="subtitle" type="text" />
        <input class="description" placeholder="description" type="text" />
        <input class="url" placeholder="url" type="text" />
        <button class="add">Add</button>
      </form>
      <div class="events">
          <h1 class="news__title">
              Spotkajmy sie tutaj
            </h1>
      <div class="news">
        
        <div class="news__block">
          <div class="block__left">
            <div class="block__frame"></div>
            <div
              style="background-image: url(https://qph.fs.quoracdn.net/main-qimg-a871765b5fb560b3dd09bb850882b6b9.webp)"
              class="block__img"
            ></div>
          </div>
          <div class="block__right">
            <h2 class="block__title">Piątek, 28 czerwca</h2>
            <h3 class="block__subtitle">Ceremonia Kakao w Kręgu Kobiet</h3>
            <p class="block__description">
              W Kręgu spotykamy się z potrzeby wyrażenia tęsknoty za dzieleniem
              miłością, bliskim spotkaniem serce w serce...
            </p>
            <a href=""
              ><button class="block__button">Dowiedz się więce</button></a
            >
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>
      // Your web app's Firebase configuration
      const usersApiUrl = "https://medycynakobiet-3713e.firebaseio.com/";
      var firebaseConfig = {
        apiKey: "AIzaSyAzNWdg_8AUfEDn6gPHfstUSzkWAPmYh0s",
        authDomain: "medycynakobiet-3713e.firebaseapp.com",
        databaseURL: "https://medycynakobiet-3713e.firebaseio.com",
        projectId: "medycynakobiet-3713e",
        storageBucket: "medycynakobiet-3713e.appspot.com",
        messagingSenderId: "712056412278",
        appId: "1:712056412278:web:8498a7b21d6e2263"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      let auth = firebase.auth();
      let db = firebase.database();
      let dbRef = db.ref();
      let logout = document.querySelector(".logout");
      let email = document.querySelector(".email");
      let password = document.querySelector(".password");
      let loginForm = document.querySelector(".log");
      let editor = document.querySelector(".editor");
      let titleInput = document.querySelector(".title");
      let subtitleInput = document.querySelector(".subtitle");
      let descriptionInput = document.querySelector(".description");
      let urlInput = document.querySelector(".url");
      let editorForm = document.querySelector(".editor__form");
      let events = [];
      let news = document.querySelector('.news')
      //  auth.createUserWithEmailAndPassword('ppxp6@wp.pl', '123456')
      //  auth.signInWithEmailAndPassword(this.state.email, this.state.password)
      auth.onAuthStateChanged(firebaseUser => {
        if (firebaseUser) {
          console.log("user");
          editor.style.display = "block";
          loginForm.style.display = "none";
        } else {
          console.log("No user");
          editor.style.display = "none";
          loginForm.style.display = "flex";
        }
      });

      loginForm.addEventListener("submit", function(e) {
        e.preventDefault();
        auth.signInWithEmailAndPassword(email.value, password.value);
      });

      logout.addEventListener("click", function() {
        auth.signOut();
      });

      editorForm.addEventListener("submit", function(e) {
        e.preventDefault();
        add();
      });

     

      function add() {
        let title = titleInput.value;
        let subtitle = subtitleInput.value;
        let description = descriptionInput.value;
        let url = urlInput.value;
        let order = highest;
        fetch(usersApiUrl + "/events/.json", {
          method: "POST",
          body: JSON.stringify({
            title,
            subtitle,
            description,
            url
          })
        });
      }

      const request = async () => {
        const response = await fetch(usersApiUrl + "/events/.json");
        const json = await response.json();

        events = Object.entries(json).map(([id, value]) => ({
          id,
          ...value
        }));
        events.sort((a, b) => (a.order > b.order ? 1 : -1));

        news.innerHTML = events.map(x => `<div class="news__block">
          <div class="block__left">
            <div class="block__frame"></div>
            <div
              style="background-image: url(https://qph.fs.quoracdn.net/main-qimg-a871765b5fb560b3dd09bb850882b6b9.webp)"
              class="block__img"
            ></div>
          </div>
          <div class="block__right">
            <h2 class="block__title">Piątek, 28 czerwca</h2>
            <h3 class="block__subtitle">Ceremonia Kakao w Kręgu Kobiet</h3>
            <p class="block__description">
              W Kręgu spotykamy się z potrzeby wyrażenia tęsknoty za dzieleniem
              miłością, bliskim spotkaniem serce w serce...
            </p>
            <a href=""
              ><button class="block__button">Dowiedz się więce</button></a
            >
          </div>
        </div>`).join('')
      };

      request();
    </script>
  </body>
</html>
